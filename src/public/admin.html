<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lite Ad Server - Admin Dashboard</title>
  <link rel="stylesheet" href="design-system.css">
  <style>
    /* Dashboard-specific styles */
    .dashboard-layout {
      display: grid;
      grid-template-columns: 250px 1fr;
      min-height: 100vh;
    }
    
    .sidebar {
      background: var(--gray-900);
      color: white;
      padding: var(--space-6);
    }
    
    .main-content {
      padding: var(--space-6);
      background: var(--gray-50);
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }
    
    .stat-card {
      background: white;
      padding: var(--space-6);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
    }
    
    .stat-value {
      font-size: var(--text-3xl);
      font-weight: var(--font-bold);
      color: var(--primary-600);
    }
    
    .stat-label {
      color: var(--gray-600);
      margin-top: var(--space-2);
    }
    
    @media (max-width: 768px) {
      .dashboard-layout {
        grid-template-columns: 1fr;
      }
      
      .sidebar {
        order: 2;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-layout">
    <!-- Sidebar Navigation -->
    <aside class="sidebar">
      <div class="sidebar-brand">
        <h2>Lite Ad Server</h2>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <h3>Campaign Management</h3>
          <ul>
            <li><a href="#dashboard" class="nav-link">Dashboard</a></li>
            <li><a href="#campaigns" class="nav-link">All Campaigns</a></li>
            <li><a href="#creatives" class="nav-link">Creative Studio</a></li>
            <li><a href="#formats" class="nav-link">Ad Formats</a></li>
          </ul>
        </div>
        
        <div class="nav-section">
          <h3>Analytics & Reports</h3>
          <ul>
            <li><a href="#analytics" class="nav-link">Analytics</a></li>
            <li><a href="#performance" class="nav-link">Performance</a></li>
            <li><a href="#revenue" class="nav-link">Revenue</a></li>
          </ul>
        </div>
        
        <div class="nav-section">
          <h3>Settings</h3>
          <ul>
            <li><a href="#integration" class="nav-link">Integration</a></li>
            <li><a href="#settings" class="nav-link">Settings</a></li>
          </ul>
        </div>
      </nav>
    </aside>
    
    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <header class="content-header">
        <div class="breadcrumb">Dashboard</div>
        <div class="header-actions">
          <button class="btn btn-primary" onclick="wizard.showWizard()">+ Create Campaign</button>
        </div>
      </header>
      
      <!-- Stats Overview -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="revenueToday">$2,543</div>
          <div class="stat-label">Revenue Today</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="impressions">12,345</div>
          <div class="stat-label">Impressions</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="clickRate">2.3%</div>
          <div class="stat-label">Click Rate</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="activeCampaigns">8</div>
          <div class="stat-label">Active Campaigns</div>
        </div>
      </div>
      
      <!-- Tab Navigation -->
      <div class="nav-tabs">
        <a href="#dashboard" class="nav-tab active">Dashboard</a>
        <a href="#campaigns" class="nav-tab">Campaigns</a>
        <a href="#analytics" class="nav-tab">Analytics</a>
        <a href="#settings" class="nav-tab">Settings</a>
      </div>
      
      <!-- Content Area -->
      <div class="content-body">
        <!-- Dynamic content will be loaded here -->
      </div>
    </main>
  </div>
  
  <!-- Include existing scripts -->
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Enhanced UI functionality
    class UIManager {
      constructor() {
        this.initializeNavigation();
        this.initializeModals();
        this.initializeTooltips();
      }
      
      initializeNavigation() {
        // Tab switching functionality
        document.querySelectorAll('.nav-tab').forEach(tab => {
          tab.addEventListener('click', (e) => {
            e.preventDefault();
            this.switchTab(tab.getAttribute('href').substring(1));
          });
        });
      }
      
      switchTab(tabName) {
        // Update active tab
        document.querySelectorAll('.nav-tab').forEach(tab => {
          tab.classList.remove('active');
        });
        document.querySelector(`[href="#${tabName}"]`).classList.add('active');
        
        // Load tab content
        this.loadTabContent(tabName);
      }
      
      loadTabContent(tabName) {
        // Load content via AJAX or show/hide sections
      }
      
      showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `alert alert-${type}`;
        notification.textContent = message;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.remove();
        }, 5000);
      }
      
      openModal(content) {
        const modal = document.createElement('div');
        modal.className = 'modal-overlay';
        modal.innerHTML = `
          <div class="modal-content">
            ${content}
          </div>
        `;
        
        document.body.appendChild(modal);
        
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.remove();
          }
        });
      }
      
      initializeModals() {}
      initializeTooltips() {}
    }
    
    // Initialize UI Manager
    const ui = new UIManager();
    const wizard = new (class CampaignWizard {
      constructor() {
        this.currentStep = 1;
        this.totalSteps = 4;
        this.campaignData = {};
      }
      
      showWizard() {
        const wizardHTML = `
          <div class="campaign-wizard">
            <div class="wizard-header">
              <h2>Create New Campaign</h2>
              <div class="wizard-progress">
                <div class="progress-bar" style="width: ${ (this.currentStep / this.totalSteps) * 100 }%"></div>
              </div>
            </div>
            
            <div class="wizard-content">
              ${this.getStepContent()}
            </div>
            
            <div class="wizard-footer">
              <button class="btn btn-secondary" onclick="wizard.previousStep()" ${this.currentStep === 1 ? 'disabled' : ''}>
                Previous
              </button>
              <button class="btn btn-primary" onclick="wizard.nextStep()">
                ${this.currentStep === this.totalSteps ? 'Create Campaign' : 'Next'}
              </button>
            </div>
          </div>
        `;
        
        ui.openModal(wizardHTML);
      }
      
      getStepContent() {
        switch(this.currentStep) {
          case 1: return this.getBasicInfoStep();
          case 2: return this.getFormatSelectionStep();
          case 3: return this.getTargetingStep();
          case 4: return this.getReviewStep();
        }
      }
      
      getBasicInfoStep() {
        return `
          <div class="wizard-step">
            <h3>Campaign Basic Information</h3>
            <div class="form-group">
              <label class="form-label">Campaign Name</label>
              <input type="text" class="form-input" id="campaignName" placeholder="Enter campaign name">
            </div>
            <div class="form-group">
              <label class="form-label">Description</label>
              <textarea class="form-textarea" id="campaignDescription" placeholder="Campaign description"></textarea>
            </div>
          </div>
        `;
      }
      
      getFormatSelectionStep() {
        return `
          <div class="wizard-step">
            <h3>Select Ad Format</h3>
            <div class="format-grid">
              <div class="format-card" data-format="banner">
                <h4>Banner Ad</h4>
                <p>Standard rectangular advertisements</p>
              </div>
              <div class="format-card" data-format="pushdown">
                <h4>PushDown Banner</h4>
                <p>Expandable banner that pushes content down</p>
              </div>
              <div class="format-card" data-format="interscroller">
                <h4>Interscroller</h4>
                <p>Full-screen ads between content sections</p>
              </div>
              <!-- More formats... -->
            </div>
          </div>
        `;
      }
      getTargetingStep() { return '<div></div>'; }
      getReviewStep() { return '<div></div>'; }
      nextStep() { if (this.currentStep < this.totalSteps) { this.currentStep++; this.showWizard(); } }
      previousStep() { if (this.currentStep > 1) { this.currentStep--; this.showWizard(); } }
    })();
    
    // WebSocket integration for real-time updates
    const socket = io();
    socket.on('connect', () => {
      console.log('Connected to server');
      ui.showNotification('Connected to server', 'success');
    });
    
    socket.on('analytics-update', (data) => {
      // Update dashboard stats in real-time
    });
  </script>

  <!-- Tag Generator Tab Content -->
  <div id="tag-generator" class="tab-content">
    <div class="card">
      <div class="card-header">
        <h3>Universal Ad Tag Generator</h3>
        <p>Generate customized ad tags for easy website integration</p>
      </div>

      <div class="card-body">
        <form id="tag-generator-form">
          <div class="grid grid-cols-2">
            <div class="form-group">
              <label class="form-label">Ad Format</label>
              <select class="form-select" name="format" required>
                <option value="banner">Banner Ad</option>
                <option value="pushdown">PushDown Banner</option>
                <option value="interscroller">Interscroller</option>
                <option value="popup">Popup/Modal</option>
                <option value="inpage">In-page Notification</option>
                <option value="interstitial">Interstitial</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Ad Size</label>
              <select class="form-select" name="size">
                <option value="728x90">728x90 (Leaderboard)</option>
                <option value="300x250">300x250 (Medium Rectangle)</option>
                <option value="970x250">970x250 (Billboard)</option>
                <option value="320x50">320x50 (Mobile Banner)</option>
                <option value="responsive">Responsive</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Placement</label>
              <select class="form-select" name="placement">
                <option value="header">Header</option>
                <option value="sidebar">Sidebar</option>
                <option value="content">Within Content</option>
                <option value="footer">Footer</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label">Geographic Targeting</label>
              <input type="text" class="form-input" name="geo" placeholder="US,CA,UK (optional)">
            </div>
          </div>

          <details class="advanced-options">
            <summary>Advanced Options</summary>
            <div class="grid grid-cols-2">
              <div class="form-group">
                <label class="form-label">Frequency Capping</label>
                <select class="form-select" name="frequency">
                  <option value="">No limit</option>
                  <option value="once_per_session">Once per session</option>
                  <option value="once_per_day">Once per day</option>
                  <option value="max_3_per_day">Max 3 per day</option>
                </select>
              </div>

              <div class="form-group">
                <label class="form-label">Scheduling</label>
                <input type="text" class="form-input" name="schedule" placeholder="9:00-17:00 (optional)">
              </div>
            </div>
          </details>

          <button type="submit" class="btn btn-primary">Generate Tag</button>
        </form>
      </div>
    </div>

    <div id="generated-tag" class="card" style="display: none;">
      <div class="card-header">
        <h3>Generated Ad Tag</h3>
        <button class="btn btn-secondary" onclick="copyToClipboard()">Copy to Clipboard</button>
      </div>

      <div class="card-body">
        <textarea id="tag-code" class="form-textarea" rows="10" readonly></textarea>

        <div class="integration-guides">
          <h4>Integration Guides:</h4>
          <div class="grid grid-cols-3">
            <div class="guide-card">
              <h5>HTML/JavaScript</h5>
              <p>Copy and paste the tag directly into your HTML</p>
            </div>
            <div class="guide-card">
              <h5>WordPress</h5>
              <p>Use our WordPress plugin or add to theme files</p>
            </div>
            <div class="guide-card">
              <h5>React/Vue</h5>
              <p>Use our component libraries for framework integration</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
  document.getElementById('tag-generator-form').addEventListener('submit', async (e) => {
    e.preventDefault();

    const formData = new FormData(e.target);
    const config = {
      format: formData.get('format'),
      size: formData.get('size'),
      placement: formData.get('placement'),
      targeting: {
        geo: formData.get('geo')?.split(',').filter(Boolean) || []
      },
      frequency: formData.get('frequency') || null,
      schedule: formData.get('schedule') || null
    };

    try {
      const response = await fetch('/admin/api/generate-tag', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(config)
      });

      const result = await response.json();

      document.getElementById('tag-code').value = result.tag;
      document.getElementById('generated-tag').style.display = 'block';
      document.getElementById('generated-tag').scrollIntoView({ behavior: 'smooth' });

    } catch (error) {
      alert('Error generating tag: ' + error.message);
    }
  });

  function copyToClipboard() {
    const tagCode = document.getElementById('tag-code');
    tagCode.select();
    document.execCommand('copy');

    const notification = document.createElement('div');
    notification.className = 'alert alert-success';
    notification.textContent = 'Tag copied to clipboard!';
    document.body.appendChild(notification);

    setTimeout(() => notification.remove(), 3000);
  }
  </script>
</body>
</html>
